!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t():"function"==typeof define&&define.amd?define(t):t()}(0,function(){var e=require("node-fetch"),t=require("cheerio"),r=console.error,n=function(e,t,r){this.user=e,this.max=t||20,this.order="popular"===r||"public"===r?r:"popular",this.selectors={hearts:".count",views:".views",comments:".comments",title:".item-title"},this.url="https://codepen.io/"+this.user+"/pens/"+this.order+"/grid",this.response=[],this.index=1,this.flag=!1};n.prototype.scrape=function(e){var r=this;return new Promise(function(n,s){var i=t.load(e);i("#no-pens-message").html()&&s(new Error("No more pens"));var o=[];i(".meta").each(function(e,t){var n=r.extract(i(t),"hearts"),s=r.extract(i(t),"views"),c=r.extract(i(t),"comments"),a=r.extract(i(t),"title");o.push({title:a,hearts:n,views:s,comments:c})}),o.forEach(function(e){return r.response.push(e)}),n(o)})},n.prototype.get=function(){var t=this,n=this.url+"/"+this.index;return this.index===this.max&&(this.flag=!0),this.flag?this.response:e(n).then(function(e){return e.json()}).then(function(e){return t.scrape(e.page.html).catch(r)}).then(function(e){return e||(t.flag=!0),t.index+=1,t.get()}).catch(r)},n.prototype.extract=function(e,t){var r=this.selectors[t],n=e.find(r).text();if(n){if(r===this.selectors.title)return n.replace(/\s\s+/g,"");var s=n.match(/\d+,?\d*,?\d*/)[0].replace(/,/,"").replace(/,/,"");return parseInt(s,10)}return 0},module.exports=n});
